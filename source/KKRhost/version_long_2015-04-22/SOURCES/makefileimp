SHELL = /bin/sh

include ./makeflags

BIN = ./
VERSION = 

INCP =  inc.imp
INCP2 = inc.p
INCG2 = inc.cls

DRVOBJS = $(OBJ)/drvcore.o $(OBJ)/drvreltmat.o \
          $(OBJ)/drvrho.o      $(OBJ)/relpotcvt.o   

RELOBJS = $(OBJ)/ssite.o  $(OBJ)/rinvgj.o    $(OBJ)/dirac_bs.o   \
        $(OBJ)/dirbslag.o $(OBJ)/dirbsmid.o  $(OBJ)/dirbsrad.o   \
        $(OBJ)/dirbsrze.o $(OBJ)/dirbsstp.o  $(OBJ)/cjlz.o       \
        $(OBJ)/cnlz.o     $(OBJ)/cdjlzdz.o   $(OBJ)/cdnlzdz.o    \
        $(OBJ)/ikapmue.o  $(OBJ)/rnuctab.o   $(OBJ)/dirac_bi.o   \
        $(OBJ)/dirac_op.o $(OBJ)/dirac_soc.o $(OBJ)/dirac_soc2.o \
        $(OBJ)/cintabr.o  $(OBJ)/sumupint.o  $(OBJ)/cinthff.o    \
        $(OBJ)/cint4pts.o $(OBJ)/scfchrdns.o $(OBJ)/calcgf.o     \
        $(OBJ)/calccgc.o  $(OBJ)/ikmlin.o    $(OBJ)/rintsimp.o   \
        $(OBJ)/ylag.o     $(OBJ)/core.o      $(OBJ)/coredir.o    \
        $(OBJ)/hffcore.o  $(OBJ)/corehff.o   $(OBJ)/coreerr.o    \
        $(OBJ)/rint4pts.o $(OBJ)/cmatstr.o   $(OBJ)/amemagvec.o  \
        $(OBJ)/calcmvec.o $(OBJ)/rmatstr.o   

SRAOBJS	= $(OBJ)/calrmt.o $(OBJ)/cinit.o $(OBJ)/grule.o \
          $(OBJ)/hankel.o $(OBJ)/intcor.o  $(OBJ)/intin.o $(OBJ)/intout.o \
          $(OBJ)/rcstop.o $(OBJ)/rinit.o $(OBJ)/ymy.o  \
          $(OBJ)/csimpk.o $(OBJ)/csum.o $(OBJ)/dclock.o \
	  $(OBJ)/generalpot.o $(OBJ)/force.o $(OBJ)/forceh.o \
          $(OBJ)/gaunt2.o $(OBJ)/shape.o $(OBJ)/simp3.o \
          $(OBJ)/simpk.o $(OBJ)/sinwk.o $(OBJ)/soutk.o $(OBJ)/ssum.o\
          $(OBJ)/vintras.o \
          $(OBJ)/irwsol.o $(OBJ)/csout.o $(OBJ)/regsol.o $(OBJ)/csinwd.o\
          $(OBJ)/wftsca.o  $(OBJ)/brydbm.o \
          $(OBJ)/brysh1.o $(OBJ)/brysh2.o $(OBJ)/brysh3.o $(OBJ)/mixstr.o\
          $(OBJ)/convol.o $(OBJ)/potcut.o $(OBJ)/cradwf.o $(OBJ)/wfmesh.o\
          $(OBJ)/pnstmat.o $(OBJ)/beshan.o $(OBJ)/pnsqns.o \
          $(OBJ)/rholm.o $(OBJ)/rhons.o  $(OBJ)/test.o \
          $(OBJ)/corel.o $(OBJ)/vllns.o $(OBJ)/regns.o $(OBJ)/wfint.o \
          $(OBJ)/wfint0.o $(OBJ)/irwns.o $(OBJ)/rhoout.o\
          $(OBJ)/rhoin.o 

SRANONMPI= $(OBJ)/calctmat.o

VXCOBJS	= $(OBJ)/corlsd.o $(OBJ)/gcor91.o $(OBJ)/cpw91.o $(OBJ)/exch91.o\
          $(OBJ)/gxcpt.o  $(OBJ)/spher.o $(OBJ)/trarea.o $(OBJ)/vosko.o\
          $(OBJ)/vxclm.o $(OBJ)/vxcspo.o $(OBJ)/vxcgga.o $(OBJ)/gradrl.o\
          $(OBJ)/mkxcpe.o $(OBJ)/sphere_gga.o  $(OBJ)/sphere_nogga.o  \
          $(OBJ)/vxcdrv.o $(OBJ)/gradr.o  $(OBJ)/cylm02.o $(OBJ)/lebedev.o

COMOBJS  = $(OBJ)/gaunt.o  $(OBJ)/wrldos.o     $(OBJ)/wrmoms.o \
          $(OBJ)/rhocore.o $(OBJ)/getscratch.o $(OBJ)/lngstring.o \
          $(OBJ)/cmatmul.o $(OBJ)/densitymat.o $(OBJ)/overlap.o

COMNONMPI = $(OBJ)/rhoval.o 

IMPOBJS = $(OBJ)/bacnosym.o $(OBJ)/bacsym.o  \
	$(OBJ)/esingpc.o $(OBJ)/esingpv.o\
        $(OBJ)/gdyson.o\
         $(OBJ)/oprot.o\
	$(OBJ)/reainp.o   $(OBJ)/start.o\
        $(OBJ)/synotn1.o $(OBJ)/sytmat.o\
        $(OBJ)/bacasym.o   \
        $(OBJ)/scaninp.o $(OBJ)/impxccplij.o $(OBJ)/table.o

IMPNONMPI=$(OBJ)/fpimpu.o $(OBJ)/enerspinloops01.o \
          $(OBJ)/hostatoms01.o $(OBJ)/impurity.o

SRAIMPOBJS =  \
             $(OBJ)/wfread.o $(OBJ)/wfwrit.o\
             $(OBJ)/conductwf.o \
	     $(OBJ)/pickblock.o \
	     $(OBJ)/resist.o  \
	     $(OBJ)/rhotot.o  $(OBJ)/rites.o


COMIMPOBJS =              $(OBJ)/cutshell.o \
	    $(OBJ)/date.o \
            $(OBJ)/ecoulom.o $(OBJ)/efgrad.o \
	   $(OBJ)/epotins.o  \
           $(OBJ)/etotal.o   \
	    $(OBJ)/forcxcimp.o  \
	   $(OBJ)/lloyd.o $(OBJ)/lloyda.o \
           $(OBJ)/lloydg.o  \
	     $(OBJ)/mtzsme.o \
           $(OBJ)/redoghnew.o \
            $(OBJ)/rotcoef.o $(OBJ)/rotcub.o \
	   $(OBJ)/rottns.o \
            $(OBJ)/shftvout.o  \
           $(OBJ)/smear2.o   \
	    $(OBJ)/sytn0.o $(OBJ)/sytn0rel.o \
           $(OBJ)/sytn1.o $(OBJ)/tmread.o \
	   $(OBJ)/tmwrit.o  $(OBJ)/vbound.o \
           $(OBJ)/vintrel.o $(OBJ)/vintrela.o  \
           $(OBJ)/wksph.o  $(OBJ)/csimpkcut.o \
           $(OBJ)/zsum.o  \
           $(OBJ)/vinters2001.o $(OBJ)/amn2001.o $(OBJ)/amngaunt.o \
           $(OBJ)/chargeplot1.o    $(OBJ)/mfield.o $(OBJ)/mpi_own.o


MPIOBJS = $(OBJ)/mpiimpurity.o $(OBJ)/mpifpimpu.o $(OBJ)/mpienerspinloops01.o \
         $(OBJ)/mpihostatoms01.o $(OBJ)/mpirhoval.o \
         $(OBJ)/mpicalctmat.o  $(OBJ)/mpimapblock.o

PROGOBJS = $(IMPOBJS) $(SRAIMPOBJS) $(COMIMPOBJS) $(SRAOBJS)\
           $(VXCOBJS) $(DRVOBJS) $(RELOBJS) $(COMOBJS)   \
           $(IMPNONMPI) $(SRANONMPI) $(COMNONMPI)

PROGMPIOBJS = $(IMPOBJS) $(SRAIMPOBJS) $(COMIMPOBJS) $(SRAOBJS) \
           $(VXCOBJS) $(DRVOBJS) $(COMOBJS)  \
           $(RELOBJS)  $(MPIOBJS)

setmpi: 
	@if test ! -d MPI;\
	then mkdir MPI; fi
	rm -f $(OBJ)/mpi*.o
	cp -p inc.imp   ./MPI/inc.imp
	cp -p inc.imp   ./MPI/inc.p
	cp -p inc.cls   ./MPI/inc.cls

mkdirobj:
	@if test ! -d $(OBJ); \
	then mkdir $(OBJ); fi

clean:
	@find . -name "*.o" -exec rm -f {} \;
copyinc:
	cp -p $(INCP) $(SRA)/$(INCP)
	cp -p $(INCP) $(SRA)/$(INCP2)
	cp -p $(INCG2) $(SRA)/$(INCG2)
	cp -p $(INCP) $(VXC)/$(INCP)
	cp -p $(INCP) $(VXC)/$(INCP2)
	cp -p $(INCG2) $(VXC)/$(INCG2)
	cp -p $(INCP) $(DRV)/$(INCP2)
	cp -p $(INCP) $(DRV)/$(INCP)
	cp -p $(INCG2) $(DRV)/$(INCG2)
	cp -p $(INCP) $(COM)/$(INCP2)
	cp -p $(INCP) $(COM)/$(INCP)
	cp -p $(INCG2) $(COM)/$(INCG2)
	cp -p $(INCP) $(IMP)/$(INCP)
	cp -p $(INCP) $(SRA_IMP)/$(INCP)
	cp -p $(INCP) $(COM_IMP)/$(INCP)
	cp -p sprkkr_rmesh.dim   $(DRV)/sprkkr_rmesh.dim
	cp -p sprkkr_rmesh.dim   $(REL)/sprkkr_rmesh.dim


kkr: mkdirobj copyinc $(PROGOBJS)
	$(LD) -o $(BIN)/kkrimp$(VERSION).exe $(PROGOBJS) $(libs) 

kkrmpi: mkdirobj setmpi copyinc $(PROGMPIOBJS)
	$(LDMPI) $(PROGMPIOBJS) $(libs) $(LIBMPI) -o $(BIN)/kkrimp$(VERSION)_mpi.exe

###################################################################
# rules expressing dependencies on Fortran files

##################### sources in IMP directory ##########
###############################################################
##################### sources in SRA directory ##########

$(OBJ)/calrmt.o       : $(SRA)/calrmt.f ; \
$(FC) $(FFLAGS)  $(SRA)/calrmt.f -c -o $@

$(OBJ)/cinit.o     :$(SRA)/cinit.f  ; \
$(FC) $(FFLAGS) $(SRA)/cinit.f -c -o $@

$(OBJ)/grule.o     :$(SRA)/grule.f  ; \
$(FC) $(FFLAGS) $(SRA)/grule.f -c -o $@

$(OBJ)/hankel.o     :$(SRA)/hankel.f  ; \
$(FC) $(FFLAGS) $(SRA)/hankel.f -c -o $@

$(OBJ)/intcor.o     :$(SRA)/intcor.f  ; \
$(FC) $(FFLAGS) $(SRA)/intcor.f -c -o $@

$(OBJ)/intin.o     :$(SRA)/intin.f  ; \
$(FC) $(FFLAGS) $(SRA)/intin.f -c -o $@

$(OBJ)/intout.o     :$(SRA)/intout.f  ; \
$(FC) $(FFLAGS) $(SRA)/intout.f -c -o $@

$(OBJ)/rcstop.o     :$(SRA)/rcstop.f  ; \
$(FC) $(FFLAGS) $(SRA)/rcstop.f -c -o $@

$(OBJ)/rinit.o     :$(SRA)/rinit.f  ; \
$(FC) $(FFLAGS) $(SRA)/rinit.f -c -o $@

$(OBJ)/ymy.o     :$(SRA)/ymy.f  ; \
$(FC) $(FFLAGS) $(SRA)/ymy.f -c -o $@


$(OBJ)/csimpk.o     :$(SRA)/csimpk.f  ; \
$(FC) $(FFLAGS) $(SRA)/csimpk.f -c -o $@

$(OBJ)/csum.o     :$(SRA)/csum.f  ; \
$(FC) $(FFLAGS) $(SRA)/csum.f -c -o $@

$(OBJ)/dclock.o     :$(SRA)/dclock.f  ; \
$(FC) $(FFLAGS) $(SRA)/dclock.f -c -o $@

$(OBJ)/generalpot.o     :$(SRA)/generalpot.f  ; \
$(FC) $(FFLAGS) $(SRA)/generalpot.f -c -o $@

$(OBJ)/force.o     :$(SRA)/force.f  ; \
$(FC) $(FFLAGS) $(SRA)/force.f -c -o $@

$(OBJ)/forceh.o     :$(SRA)/forceh.f  ; \
$(FC) $(FFLAGS) $(SRA)/forceh.f -c -o $@

$(OBJ)/gaunt2.o     :$(SRA)/gaunt2.f  ; \
$(FC) $(FFLAGS) $(SRA)/gaunt2.f -c -o $@

$(OBJ)/shape.o     :$(SRA)/shape.f  ; \
$(FC) $(FFLAGS) $(SRA)/shape.f -c -o $@

$(OBJ)/simp3.o     :$(SRA)/simp3.f  ; \
$(FC) $(FFLAGS) $(SRA)/simp3.f -c -o $@

$(OBJ)/simpk.o     :$(SRA)/simpk.f  ; \
$(FC) $(FFLAGS) $(SRA)/simpk.f -c -o $@

$(OBJ)/sinwk.o     :$(SRA)/sinwk.f  ; \
$(FC) $(FFLAGS) $(SRA)/sinwk.f -c -o $@

$(OBJ)/soutk.o     :$(SRA)/soutk.f  ; \
$(FC) $(FFLAGS) $(SRA)/soutk.f -c -o $@

$(OBJ)/ssum.o     :$(SRA)/ssum.f  ; \
$(FC) $(FFLAGS) $(SRA)/ssum.f -c -o $@

$(OBJ)/splint.o     :$(SRA)/splint.f  ; \
$(FC) $(FFLAGS) $(SRA)/splint.f -c -o $@

$(OBJ)/spline.o     :$(SRA)/spline.f  ; \
$(FC) $(FFLAGS) $(SRA)/spline.f -c -o $@

$(OBJ)/vintras.o     :$(SRA)/vintras.f  ; \
$(FC) $(FFLAGS) $(SRA)/vintras.f -c -o $@

$(OBJ)/irwsol.o     :$(SRA)/irwsol.f  ; \
$(FC) $(FFLAGS) $(SRA)/irwsol.f -c -o $@

$(OBJ)/csout.o     :$(SRA)/csout.f  ; \
$(FC) $(FFLAGS) $(SRA)/csout.f -c -o $@

$(OBJ)/regsol.o     :$(SRA)/regsol.f  ; \
$(FC) $(FFLAGS) $(SRA)/regsol.f -c -o $@

$(OBJ)/csinwd.o     :$(SRA)/csinwd.f  ; \
$(FC) $(FFLAGS) $(SRA)/csinwd.f -c -o $@

$(OBJ)/wftsca.o     :$(SRA)/wftsca.f  ; \
$(FC) $(FFLAGS) $(SRA)/wftsca.f -c -o $@

$(OBJ)/brydbm.o     :$(SRA)/brydbm.f  ; \
$(FC) $(FFLAGS) $(SRA)/brydbm.f -c -o $@

$(OBJ)/brysh1.o     :$(SRA)/brysh1.f  ; \
$(FC) $(FFLAGS) $(SRA)/brysh1.f -c -o $@

$(OBJ)/brysh2.o     :$(SRA)/brysh2.f  ; \
$(FC) $(FFLAGS) $(SRA)/brysh2.f -c -o $@

$(OBJ)/brysh3.o     :$(SRA)/brysh3.f  ; \
$(FC) $(FFLAGS) $(SRA)/brysh3.f -c -o $@

$(OBJ)/mixstr.o     :$(SRA)/mixstr.f  ; \
$(FC) $(FFLAGS) $(SRA)/mixstr.f -c -o $@

$(OBJ)/convol.o     :$(SRA)/convol.f  ; \
$(FC) $(FFLAGS) $(SRA)/convol.f -c -o $@

$(OBJ)/potcut.o     :$(SRA)/potcut.f  ; \
$(FC) $(FFLAGS) $(SRA)/potcut.f -c -o $@

$(OBJ)/cradwf.o     :$(SRA)/cradwf.f  ; \
$(FC) $(FFLAGS) $(SRA)/cradwf.f -c -o $@

$(OBJ)/wfmesh.o     :$(SRA)/wfmesh.f  ; \
$(FC) $(FFLAGS) $(SRA)/wfmesh.f -c -o $@

$(OBJ)/pnstmat.o     :$(SRA)/pnstmat.f  ; \
$(FC) $(FFLAGS) $(SRA)/pnstmat.f -c -o $@

$(OBJ)/beshan.o     :$(SRA)/beshan.f  ; \
$(FC) $(FFLAGS) $(SRA)/beshan.f -c -o $@

$(OBJ)/pnsqns.o     :$(SRA)/pnsqns.f  ; \
$(FC) $(FFLAGS) $(SRA)/pnsqns.f -c -o $@

$(OBJ)/rholm.o     :$(SRA)/rholm.f  ; \
$(FC) $(FFLAGS) $(SRA)/rholm.f -c -o $@

$(OBJ)/rhons.o     :$(SRA)/rhons.f  ; \
$(FC) $(FFLAGS) $(SRA)/rhons.f -c -o $@

$(OBJ)/test.o     :$(SRA)/test.f  ; \
$(FC) $(FFLAGS) $(SRA)/test.f -c -o $@

$(OBJ)/corel.o     :$(SRA)/corel.f  ; \
$(FC) $(FFLAGS) $(SRA)/corel.f -c -o $@

$(OBJ)/vllns.o     :$(SRA)/vllns.f  ; \
$(FC) $(FFLAGS) $(SRA)/vllns.f -c -o $@

$(OBJ)/regns.o     :$(SRA)/regns.f  ; \
$(FC) $(FFLAGS) $(SRA)/regns.f -c -o $@

$(OBJ)/wfint.o     :$(SRA)/wfint.f  ; \
$(FC) $(FFLAGS) $(SRA)/wfint.f -c -o $@

$(OBJ)/wfint0.o     :$(SRA)/wfint0.f  ; \
$(FC) $(FFLAGS) $(SRA)/wfint0.f -c -o $@

$(OBJ)/irwns.o     :$(SRA)/irwns.f  ; \
$(FC) $(FFLAGS) $(SRA)/irwns.f -c -o $@

$(OBJ)/rhoout.o     :$(SRA)/rhoout.f  ; \
$(FC) $(FFLAGS) $(SRA)/rhoout.f -c -o $@

$(OBJ)/rhoin.o     :$(SRA)/rhoin.f  ; \
$(FC) $(FFLAGS) $(SRA)/rhoin.f -c -o $@

############################################################

###############################################################
##################### sources in VXC directory ##########
$(OBJ)/corlsd.o     :$(VXC)/corlsd.f  ; \
$(FC) $(FFLAGS) $(VXC)/corlsd.f -c -o $@

$(OBJ)/gcor91.o     :$(VXC)/gcor91.f  ; \
$(FC) $(FFLAGS) $(VXC)/gcor91.f -c -o $@

$(OBJ)/cpw91.o     :$(VXC)/cpw91.f  ; \
$(FC) $(FFLAGS) $(VXC)/cpw91.f -c -o $@

$(OBJ)/exch91.o     :$(VXC)/exch91.f  ; \
$(FC) $(FFLAGS) $(VXC)/exch91.f -c -o $@

$(OBJ)/gxcpt.o     :$(VXC)/gxcpt.f  ; \
$(FC) $(FFLAGS) $(VXC)/gxcpt.f -c -o $@

$(OBJ)/spher.o     :$(VXC)/spher.f  ; \
$(FC) $(FFLAGS) $(VXC)/spher.f -c -o $@

$(OBJ)/trarea.o     :$(VXC)/trarea.f  ; \
$(FC) $(FFLAGS) $(VXC)/trarea.f -c -o $@

$(OBJ)/vosko.o     :$(VXC)/vosko.f  ; \
$(FC) $(FFLAGS) $(VXC)/vosko.f -c -o $@

$(OBJ)/vxcspo.o     :$(VXC)/vxcspo.f  ; \
$(FC) $(FFLAGS) $(VXC)/vxcspo.f -c -o $@

$(OBJ)/vxclm.o     :$(VXC)/vxclm.f  ; \
$(FC) $(FFLAGS) $(VXC)/vxclm.f -c -o $@


$(OBJ)/vxcdrv.o     :$(VXC)/vxcdrv.f  ; \
$(FC) $(FFLAGS) $(VXC)/vxcdrv.f -c -o $@

$(OBJ)/sphere_nogga.o     :$(VXC)/sphere_nogga.f  ; \
$(FC) $(FFLAGS) $(VXC)/sphere_nogga.f -c -o $@

$(OBJ)/sphere_gga.o     :$(VXC)/sphere_gga.f  ; \
$(FC) $(FFLAGS) $(VXC)/sphere_gga.f -c -o $@

$(OBJ)/lebedev.o     :$(VXC)/lebedev.f  ; \
$(FC) $(FFLAGS) $(VXC)/lebedev.f -c -o $@

$(OBJ)/cylm02.o     :$(VXC)/cylm02.f  ; \
$(FC) $(FFLAGS) $(VXC)/cylm02.f -c -o $@

$(OBJ)/vxcgga.o     :$(VXC)/vxcgga.f  ; \
$(FC) $(FFLAGS) $(VXC)/vxcgga.f -c -o $@

$(OBJ)/gradrl.o     :$(VXC)/gradrl.f  ; \
$(FC) $(FFLAGS) $(VXC)/gradrl.f -c -o $@

$(OBJ)/gradr.o     :$(VXC)/gradr.f  ; \
$(FC) $(FFLAGS) $(VXC)/gradr.f -c -o $@

$(OBJ)/mkxcpe.o     :$(VXC)/mkxcpe.f  ; \
$(FC) $(FFLAGS) $(VXC)/mkxcpe.f -c -o $@

############################################################
###############################################################
##################### sources in COM directory ##########
$(OBJ)/getscratch.o     :$(COM)/getscratch.f  ; \
$(FC) $(FFLAGS) $(COM)/getscratch.f -c -o $@

$(OBJ)/densitymat.o : $(COM)/densitymat.f  $(INCP)        ;\
                      $(FC) $(FFLAGS) $(COM)/densitymat.f  -c -o $@

$(OBJ)/overlap.o    : $(COM)/overlap.f  $(INCP)        ;\
                     $(FC) $(FFLAGS) $(COM)/overlap.f  -c -o $@
$(OBJ)/lngstring.o  : $(COM)/lngstring.f     ; \
$(FC) $(FFLAGS) $(COM)/lngstring.f -c -o $@

$(OBJ)/cmatmul.o    : $(COM)/cmatmul.f       ; \
$(FC) $(FFLAGS) $(COM)/cmatmul.f -c -o $@

$(OBJ)/rhocore.o     :$(COM)/rhocore.f  ; \
$(FC) $(FFLAGS) $(COM)/rhocore.f -c -o $@

$(OBJ)/gaunt.o     :$(COM)/gaunt.f  ; \
$(FC) $(FFLAGS) $(COM)/gaunt.f -c -o $@

$(OBJ)/wrldos.o     :$(COM)/wrldos.f  ; \
$(FC) $(FFLAGS) $(COM)/wrldos.f -c -o $@

$(OBJ)/wrmoms.o     :$(COM)/wrmoms.f  ; \
$(FC) $(FFLAGS) $(COM)/wrmoms.f -c -o $@

$(OBJ)/calctmat.o     :$(COM)/calctmat.f  ; \
$(FC) $(FFLAGS) $(COM)/calctmat.f -c -o $@

$(OBJ)/rhoval.o     :$(COM)/rhoval.f  ; \
$(FC) $(FFLAGS) $(COM)/rhoval.f -c -o $@
###############################################################
##################### sources in SRA_IMP directory ##########

$(OBJ)/wfread.o     :$(SRA_IMP)/wfread.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/wfread.f -c -o $@

$(OBJ)/wfwrit.o     :$(SRA_IMP)/wfwrit.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/wfwrit.f -c -o $@

$(OBJ)/breit.o     :$(SRA_IMP)/breit.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/breit.f -c -o $@

$(OBJ)/conductwf.o     :$(SRA_IMP)/conductwf.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/conductwf.f -c -o $@


$(OBJ)/pickblock.o     :$(SRA_IMP)/pickblock.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/pickblock.f -c -o $@


$(OBJ)/resist.o     :$(SRA_IMP)/resist.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/resist.f -c -o $@


#$(OBJ)/rholm_imp.o     :$(SRA_IMP)/rholm_imp.f  ; \
#$(FC) $(FFLAGS) $(SRA_IMP)/rholm_imp.f -c -o $@

#$(OBJ)/rhons_imp.o     :$(SRA_IMP)/rhons_imp.f  ; \
#$(FC) $(FFLAGS) $(SRA_IMP)/rhons_imp.f -c -o $@


$(OBJ)/rhotot.o     :$(SRA_IMP)/rhotot.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/rhotot.f -c -o $@

$(OBJ)/rites.o     :$(SRA_IMP)/rites.f  ; \
$(FC) $(FFLAGS) $(SRA_IMP)/rites.f -c -o $@



###############################################################
##################### sources in COM_IMP directory ##########

$(OBJ)/cutshell.o     :$(COM_IMP)/cutshell.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/cutshell.f -c -o $@

$(OBJ)/date.o     :$(COM_IMP)/date.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/date.f -c -o $@

$(OBJ)/ecoulom.o     :$(COM_IMP)/ecoulom.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/ecoulom.f -c -o $@

$(OBJ)/efgrad.o     :$(COM_IMP)/efgrad.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/efgrad.f -c -o $@

$(OBJ)/epotins.o     :$(COM_IMP)/epotins.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/epotins.f -c -o $@

$(OBJ)/etotal.o     :$(COM_IMP)/etotal.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/etotal.f -c -o $@

$(OBJ)/forcxcimp.o     :$(COM_IMP)/forcxcimp.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/forcxcimp.f -c -o $@

$(OBJ)/jmtrx.o     :$(COM_IMP)/jmtrx.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/jmtrx.f -c -o $@

$(OBJ)/lloyd.o     :$(COM_IMP)/lloyd.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/lloyd.f -c -o $@

$(OBJ)/lloyda.o     :$(COM_IMP)/lloyda.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/lloyda.f -c -o $@

$(OBJ)/lloydg.o     :$(COM_IMP)/lloydg.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/lloydg.f -c -o $@

$(OBJ)/mtzsme.o     :$(COM_IMP)/mtzsme.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/mtzsme.f -c -o $@

$(OBJ)/redoghnew.o     :$(COM_IMP)/redoghnew.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/redoghnew.f -c -o $@

$(OBJ)/rotcoef.o     :$(COM_IMP)/rotcoef.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/rotcoef.f -c -o $@

$(OBJ)/rotcub.o     :$(COM_IMP)/rotcub.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/rotcub.f -c -o $@

$(OBJ)/rottns.o     :$(COM_IMP)/rottns.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/rottns.f -c -o $@

$(OBJ)/shftvout.o     :$(COM_IMP)/shftvout.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/shftvout.f -c -o $@

$(OBJ)/smear2.o     :$(COM_IMP)/smear2.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/smear2.f -c -o $@

$(OBJ)/sytn0.o     :$(COM_IMP)/sytn0.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/sytn0.f -c -o $@

$(OBJ)/sytn0rel.o     :$(COM_IMP)/sytn0rel.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/sytn0rel.f -c -o $@

$(OBJ)/sytn1.o     :$(COM_IMP)/sytn1.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/sytn1.f -c -o $@

$(OBJ)/tmread.o     :$(COM_IMP)/tmread.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/tmread.f -c -o $@

$(OBJ)/tmwrit.o     :$(COM_IMP)/tmwrit.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/tmwrit.f -c -o $@

$(OBJ)/vbound.o     :$(COM_IMP)/vbound.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/vbound.f -c -o $@

$(OBJ)/vinters.o     :$(COM_IMP)/vinters.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/vinters.f -c -o $@

$(OBJ)/vintersa.o     :$(COM_IMP)/vintersa.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/vintersa.f -c -o $@

$(OBJ)/vintrel.o     :$(COM_IMP)/vintrel.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/vintrel.f -c -o $@

$(OBJ)/vintrela.o     :$(COM_IMP)/vintrela.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/vintrela.f -c -o $@

$(OBJ)/wksph.o     :$(COM_IMP)/wksph.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/wksph.f -c -o $@

$(OBJ)/wldos.o     :$(COM_IMP)/wldos.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/wldos.f -c -o $@

$(OBJ)/wlrho.o     :$(COM_IMP)/wlrho.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/wlrho.f -c -o $@


$(OBJ)/vinters_surface.o     :$(COM_IMP)/vinters_surface.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/vinters_surface.f -c -o $@

$(OBJ)/csimpkcut.o     :$(COM_IMP)/csimpkcut.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/csimpkcut.f -c -o $@

$(OBJ)/zsum.o     :$(COM_IMP)/zsum.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/zsum.f -c -o $@

$(OBJ)/vinters2001.o     :$(COM_IMP)/vinters2001.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/vinters2001.f -c -o $@

$(OBJ)/amn2001.o     :$(COM_IMP)/amn2001.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/amn2001.f -c -o $@

$(OBJ)/amngaunt.o     :$(COM_IMP)/amngaunt.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/amngaunt.f -c -o $@

$(OBJ)/chargeplot1.o     :$(COM_IMP)/chargeplot1.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/chargeplot1.f -c -o $@

$(OBJ)/mpi_own.o     :$(COM_IMP)/mpi_own.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/mpi_own.f -c -o $@

$(OBJ)/mfield.o     :$(COM_IMP)/mfield.f  ; \
$(FC) $(FFLAGS) $(COM_IMP)/mfield.f -c -o $@
###############################################################
##################### sources in IMP directory ##########
$(OBJ)/table.o     :$(IMP)/table.f ; \
$(FC) $(FFLAGS) $(IMP)/table.f -c -o $@

$(OBJ)/impxccplij.o     :$(IMP)/impxccplij.f ; \
$(FC) $(FFLAGS) $(IMP)/impxccplij.f -c -o $@

$(OBJ)/scaninp.o     :$(IMP)/scaninp.f ; \
$(FC) $(FFLAGS) $(IMP)/scaninp.f -c -o $@

$(OBJ)/bacnosym.o     :$(IMP)/bacnosym.f ; \
$(FC) $(FFLAGS) $(IMP)/bacnosym.f -c -o $@

$(OBJ)/bacsym.o     :$(IMP)/bacsym.f  ; \
$(FC) $(FFLAGS) $(IMP)/bacsym.f -c -o $@

$(OBJ)/enerspinloops01.o     :$(IMP)/enerspinloops01.f  ; \
$(FC) $(FFLAGS) $(IMP)/enerspinloops01.f -c -o $@

$(OBJ)/hostatoms01.o     :$(IMP)/hostatoms01.f  ; \
$(FC) $(FFLAGS) $(IMP)/hostatoms01.f -c -o $@

$(OBJ)/esingpc.o     :$(IMP)/esingpc.f  ; \
$(FC) $(FFLAGS) $(IMP)/esingpc.f -c -o $@

$(OBJ)/esingpv.o     :$(IMP)/esingpv.f  ; \
$(FC) $(FFLAGS) $(IMP)/esingpv.f -c -o $@

$(OBJ)/fpimpu.o     :$(IMP)/fpimpu.f  ; \
$(FC) $(FFLAGS) $(IMP)/fpimpu.f -c -o $@

$(OBJ)/gdyson.o     :$(IMP)/gdyson.f  ; \
$(FC) $(FFLAGS) $(IMP)/gdyson.f -c -o $@

$(OBJ)/impurity.o     :$(IMP)/impurity.f  ; \
$(FC) $(FFLAGS) $(IMP)/impurity.f -c -o $@

$(OBJ)/oprot.o     :$(IMP)/oprot.f  ; \
$(FC) $(FFLAGS) $(IMP)/oprot.f -c -o $@

$(OBJ)/reainp.o     :$(IMP)/reainp.f  ; \
$(FC) $(FFLAGS) $(IMP)/reainp.f -c -o $@

$(OBJ)/start.o     :$(IMP)/start.f  ; \
$(FC) $(FFLAGS) $(IMP)/start.f -c -o $@

$(OBJ)/synotn1.o     :$(IMP)/synotn1.f  ; \
$(FC) $(FFLAGS) $(IMP)/synotn1.f -c -o $@

$(OBJ)/sytmat.o     :$(IMP)/sytmat.f  ; \
$(FC) $(FFLAGS) $(IMP)/sytmat.f -c -o $@

$(OBJ)/bacasym.o     :$(IMP)/bacasym.f  ; \
$(FC) $(FFLAGS) $(IMP)/bacasym.f -c -o $@

##################### sources in REL directory ##########
$(OBJ)/amemagvec.o       : $(REL)/amemagvec.f                   ; \
	             $(FC) $(FFLAGS) $(REL)/amemagvec.f -c -o $@

$(OBJ)/calcmvec.o       : $(REL)/calcmvec.f                   ; \
	             $(FC) $(FFLAGS) $(REL)/calcmvec.f -c -o $@

$(OBJ)/rmatstr.o       : $(REL)/rmatstr.f                   ; \
	             $(FC) $(FFLAGS) $(REL)/rmatstr.f -c -o $@

$(OBJ)/cmatstr.o       : $(REL)/cmatstr.f                   ; \
	             $(FC) $(FFLAGS) $(REL)/cmatstr.f -c -o $@

$(OBJ)/ssite.o       : $(REL)/ssite.f                   ; \
	             $(FC) $(FFLAGS) $(REL)/ssite.f -c -o $@

$(OBJ)/rinvgj.o      : $(REL)/rinvgj.f                  ; \
	             $(FC) $(FFLAGS) $(REL)/rinvgj.f -c -o $@

$(OBJ)/dirac_bs.o    : $(REL)/dirac_bs.f  $(INCR)       ; \
	             $(FC) $(FFLAGS) $(REL)/dirac_bs.f -c -o $@

$(OBJ)/dirbslag.o    : $(REL)/dirbslag.f                ; \
	             $(FC) $(FFLAGS) $(REL)/dirbslag.f -c -o $@

$(OBJ)/dirbsrze.o    : $(REL)/dirbsrze.f                ; \
	             $(FC) $(FFLAGS) $(REL)/dirbsrze.f -c -o $@

$(OBJ)/dirbsrad.o    : $(REL)/dirbsrad.f  $(INCR)       ; \
	             $(FC) $(FFLAGS) $(REL)/dirbsrad.f -c -o $@

$(OBJ)/dirbsmid.o    : $(REL)/dirbsmid.f  $(INCR)       ; \
	             $(FC) $(FFLAGS) $(REL)/dirbsmid.f -c -o $@

$(OBJ)/dirbsstp.o    : $(REL)/dirbsstp.f  $(INCR)       ; \
	             $(FC) $(FFLAGS) $(REL)/dirbsstp.f -c -o $@

$(OBJ)/cjlz.o        : $(REL)/cjlz.f                    ; \
	             $(FC) $(FFLAGS) $(REL)/cjlz.f -c -o $@

$(OBJ)/cnlz.o        : $(REL)/cnlz.f                    ; \
	             $(FC) $(FFLAGS) $(REL)/cnlz.f -c -o $@

$(OBJ)/cdjlzdz.o     : $(REL)/cdjlzdz.f                 ; \
	             $(FC) $(FFLAGS) $(REL)/cdjlzdz.f -c -o $@

$(OBJ)/cdnlzdz.o     : $(REL)/cdnlzdz.f                 ; \
	             $(FC) $(FFLAGS) $(REL)/cdnlzdz.f -c -o $@

$(OBJ)/ikapmue.o     : $(REL)/ikapmue.f                 ; \
	             $(FC) $(FFLAGS) $(REL)/ikapmue.f -c -o $@

$(OBJ)/rnuctab.o     : $(REL)/rnuctab.f                 ; \
	             $(FC) $(FFLAGS) $(REL)/rnuctab.f -c -o $@

$(OBJ)/dirac_bi.o    : $(REL)/dirac_bi.f                ; \
	             $(FC) $(FFLAGS) $(REL)/dirac_bi.f -c -o $@

$(OBJ)/dirac_op.o    : $(REL)/dirac_op.f                ; \
	             $(FC) $(FFLAGS) $(REL)/dirac_op.f -c -o $@

$(OBJ)/dirac_soc.o   : $(REL)/dirac_soc.f               ; \
	             $(FC) $(FFLAGS) $(REL)/dirac_soc.f -c -o $@

$(OBJ)/dirac_soc2.o  : $(REL)/dirac_soc2.f              ; \
	             $(FC) $(FFLAGS) $(REL)/dirac_soc2.f -c -o $@

$(OBJ)/cintabr.o     : $(REL)/cintabr.f                 ; \
	             $(FC) $(FFLAGS) $(REL)/cintabr.f -c -o $@

$(OBJ)/sumupint.o    : $(REL)/sumupint.f                ; \
	             $(FC) $(FFLAGS) $(REL)/sumupint.f -c -o $@

$(OBJ)/cinthff.o     : $(REL)/cinthff.f                 ; \
	             $(FC) $(FFLAGS) $(REL)/cinthff.f -c -o $@

$(OBJ)/cint4pts.o    : $(REL)/cint4pts.f                ; \
	             $(FC) $(FFLAGS) $(REL)/cint4pts.f -c -o $@
$(OBJ)/scfchrdns.o   : $(REL)/scfchrdns.f               ; \
                     $(FC) $(FFLAGS) $(REL)/scfchrdns.f -c -o $@

$(OBJ)/calcgf.o      : $(REL)/calcgf.f               ; \
                     $(FC) $(FFLAGS) $(REL)/calcgf.f -c -o $@

$(OBJ)/calccgc.o     : $(REL)/calccgc.f               ; \
                     $(FC) $(FFLAGS) $(REL)/calccgc.f -c -o $@

$(OBJ)/ikmlin.o      : $(REL)/ikmlin.f               ; \
                     $(FC) $(FFLAGS) $(REL)/ikmlin.f -c -o $@

$(OBJ)/rintsimp.o    : $(REL)/rintsimp.f               ; \
                     $(FC) $(FFLAGS) $(REL)/rintsimp.f -c -o $@

$(OBJ)/ylag.o        : $(REL)/ylag.f               ; \
                     $(FC) $(FFLAGS) $(REL)/ylag.f -c -o $@

$(OBJ)/core.o        : $(REL)/core.f      ; \
                     $(FC) $(FFLAGS) $(REL)/core.f -c -o $@

$(OBJ)/coredir.o     : $(REL)/coredir.f   ; \
                     $(FC) $(FFLAGS) $(REL)/coredir.f -c -o $@

$(OBJ)/hffcore.o     : $(REL)/hffcore.f   ; \
                     $(FC) $(FFLAGS) $(REL)/hffcore.f -c -o $@

$(OBJ)/corehff.o     : $(REL)/corehff.f   ; \
                     $(FC) $(FFLAGS) $(REL)/corehff.f  -c -o $@

$(OBJ)/coreerr.o     : $(REL)/coreerr.f   ; \
                     $(FC) $(FFLAGS) $(REL)/coreerr.f  -c -o $@ 

$(OBJ)/rint4pts.o    : $(REL)/rint4pts.f  ; \
                     $(FC) $(FFLAGS) $(REL)/rint4pts.f -c -o $@

############################################################
$(OBJ)/drvcore.o     :$(DRV)/drvcore.f  ; \
$(FC) $(FFLAGS) $(DRV)/drvcore.f -c -o $@

$(OBJ)/drvreltmat.o     :$(DRV)/drvreltmat.f  ; \
$(FC) $(FFLAGS) $(DRV)/drvreltmat.f -c -o $@

$(OBJ)/drvrho.o     :$(DRV)/drvrho.f  ; \
$(FC) $(FFLAGS) $(DRV)/drvrho.f -c -o $@

$(OBJ)/relpotcvt.o       : $(DRV)/relpotcvt.f                   ; \
$(FC) $(FFLAGS) $(DRV)/relpotcvt.f -c -o $@
############################################################
#  MPI OBJECTS MPI MPI OBJECTS 
#
$(OBJ)/mpiimpurity.o   : $(IMP)/impurity.f $(INCP) $(INCC)
	cat $(IMP)/impurity.f | sed 's/CMPI /     /' > ./MPI/mpiimpurity.f
	$(FC) $(FFLAGS) ./MPI/mpiimpurity.f -c -o $@	

$(OBJ)/mpimapblock.o   : $(SRA)/mapblock.f $(INCP) $(INCC)
	cat $(SRA)/mapblock.f | sed 's/CMPI /     /' > ./MPI/mpimapblock.f
	$(FC) $(FFLAGS) ./MPI/mpimapblock.f -c -o $@	

$(OBJ)/mpifpimpu.o: $(IMP)/fpimpu.f $(INCP) $(INCC)
		    cat $(IMP)/fpimpu.f | sed 's/CMPI /     /' > ./MPI/mpifpimpu.f
		    $(FC) $(FFLAGS) ./MPI/mpifpimpu.f -c -o $@	

$(OBJ)/mpicalctmat.o   : $(COM)/calctmat.f $(INCP) $(INCC)
	cat $(COM)/calctmat.f | sed 's/CMPI /     /' > ./MPI/mpicalctmat.f
	$(FC) $(FFLAGS) ./MPI/mpicalctmat.f -c -o $@	

$(OBJ)/mpirhoval.o   : $(COM)/rhoval.f $(INCP) $(INCC)
	cat $(COM)/rhoval.f | sed 's/CMPI /     /' > ./MPI/mpirhoval.f
	$(FC) $(FFLAGS) ./MPI/mpirhoval.f -c -o $@	

$(OBJ)/mpienerspinloops01.o   : $(IMP)/enerspinloops01.f $(INCP) $(INCC)
	cat $(IMP)/enerspinloops01.f | sed 's/CMPI /     /' > ./MPI/mpienerspinloops01.f
	$(FC) $(FFLAGS) ./MPI/mpienerspinloops01.f -c -o $@	

$(OBJ)/mpihostatoms01.o   : $(IMP)/hostatoms01.f $(INCP) $(INCC)
	cat $(IMP)/hostatoms01.f | sed 's/CMPI /     /' > ./MPI/mpihostatoms01.f
	$(FC) $(FFLAGS) ./MPI/mpihostatoms01.f -c -o $@	
