SHELL = /bin/sh

include ./makeflags

SRAOBJS = \
          $(OBJ)/brydbm.o      $(OBJ)/brysh1.o     $(OBJ)/brysh2.o \
          $(OBJ)/brysh3.o      $(OBJ)/convol.o     $(OBJ)/dclock.o \
          $(OBJ)/ecoub.o       $(OBJ)/epotinb.o    $(OBJ)/espcb.o  \
          $(OBJ)/force.o       $(OBJ)/forceh.o     $(OBJ)/forcxc.o \
          $(OBJ)/gaufd.o       $(OBJ)/gauleg.o     $(OBJ)/emesht.o \
          $(OBJ)/mixstr.o      $(OBJ)/mtzero.o     $(OBJ)/erfcex.o \
          $(OBJ)/opt.o         $(OBJ)/rcstop.o     $(OBJ)/reg2.o   \
          $(OBJ)/rhosymm.o     $(OBJ)/rinit.o      $(OBJ)/rites.o  \
          $(OBJ)/simp3.o       $(OBJ)/simpk.o      $(OBJ)/sinwk.o  \
          $(OBJ)/soutk.o       $(OBJ)/vintras.o    $(OBJ)/ymy.o    \
          $(OBJ)/ssum.o        $(OBJ)/test.o       
          


VXCOBJS = $(OBJ)/corlsd.o      $(OBJ)/cpw91.o      $(OBJ)/cylm02.o \
          $(OBJ)/exch91.o      $(OBJ)/gcor91.o     $(OBJ)/gradr.o \
          $(OBJ)/gradrl.o      $(OBJ)/gxcpt.o      $(OBJ)/mkxcpe.o \
          $(OBJ)/spher.o       $(OBJ)/sphere_gga.o $(OBJ)/sphere_nogga.o \
          $(OBJ)/trarea.o      $(OBJ)/vosko.o      $(OBJ)/vxcdrv.o \
          $(OBJ)/vxcgga.o      $(OBJ)/vxclm.o      $(OBJ)/vxcspo.o \
          $(OBJ)/lebedev.o



COMOBJS = $(OBJ)/main2.o       $(OBJ)/epathtb.o \
          $(OBJ)/vmadelblk.o   $(OBJ)/vinterface.o $(OBJ)/etotb1.o \
          $(OBJ)/rhototb.o     $(OBJ)/calcrotmat.o $(OBJ)/errortrap.o

DRVOBJS = $(OBJ)/relpotcvt.o

RELOBJS = $(OBJ)/mdirnewang.o  $(OBJ)/scfiterang.o

VIROBJS = $(OBJ)/writekkrflex.o 

PROGOBJS = $(COMOBJS) $(SRAOBJS) $(VXCOBJS) $(RELOBJS) $(DRVOBJS) $(VIROBJS)
                  
mkdirobj:
	@if test ! -d $(OBJ); \
	then mkdir $(OBJ); fi

clean:
	@find . -name "*.o" -exec rm -f {} \;
copyinc:
	cp -p inc.p   $(SRA)/inc.p
	cp -p inc.p   $(COM)/inc.p
	cp -p inc.p   $(VXC)/inc.p
	cp -p inc.cls $(SRA)/inc.cls
	cp -p inc.cls $(COM)/inc.cls

kkr : mkdirobj copyinc $(PROGOBJS)
	$(LD) -o $(BIN)/kkr2.exe $(PROGOBJS) $(libs) 

###################################################################
# rules expressing dependencies on Fortran include files


##################### sources in SRA directory ##########
$(OBJ)/brydbm.o       : $(SRA)/brydbm.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/brydbm.f -c -o $@

$(OBJ)/brysh1.o       : $(SRA)/brysh1.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/brysh1.f -c -o $@

$(OBJ)/brysh2.o       : $(SRA)/brysh2.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/brysh2.f -c -o $@

$(OBJ)/brysh3.o       : $(SRA)/brysh3.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/brysh3.f -c -o $@

$(OBJ)/convol.o       : $(SRA)/convol.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/convol.f -c -o $@

$(OBJ)/dclock.o       : $(SRA)/dclock.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/dclock.f -c -o $@

$(OBJ)/ecoub.o        : $(SRA)/ecoub.f   $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/ecoub.f -c -o $@

$(OBJ)/emesht.o       : $(SRA)/emesht.f                ; \
                         $(FC) $(FFLAGS) $(SRA)/emesht.f -c -o $@

$(OBJ)/epotinb.o      : $(SRA)/epotinb.f $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/epotinb.f -c -o $@

$(OBJ)/erfcex.o       : $(SRA)/erfcex.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/erfcex.f -c -o $@

$(OBJ)/espcb.o        : $(SRA)/espcb.f   $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/espcb.f -c -o $@

$(OBJ)/force.o        : $(SRA)/force.f   $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/force.f -c -o $@

$(OBJ)/forceh.o       : $(SRA)/forceh.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/forceh.f -c -o $@

$(OBJ)/forcxc.o       : $(SRA)/forcxc.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/forcxc.f -c -o $@

$(OBJ)/gaufd.o        : $(SRA)/gaufd.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/gaufd.f -c -o $@

$(OBJ)/gauleg.o       : $(SRA)/gauleg.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/gauleg.f -c -o $@

$(OBJ)/mixstr.o       : $(SRA)/mixstr.f  $(INCP)             ; \
                         $(FC) $(FFLAGS) $(SRA)/mixstr.f -c -o $@

$(OBJ)/mtzero.o       : $(SRA)/mtzero.f  $(INCP)             ; \
                         $(FC) $(FFLAGS) $(SRA)/mtzero.f -c -o $@

$(OBJ)/opt.o          : $(SRA)/opt.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/opt.f -c -o $@

$(OBJ)/rcstop.o       : $(SRA)/rcstop.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/rcstop.f -c -o $@

$(OBJ)/reg2.o         : $(SRA)/reg2.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/reg2.f -c -o $@

$(OBJ)/rhosymm.o      : $(SRA)/rhosymm.f $(INCP)              ; \
                         $(FC) $(FFLAGS) $(SRA)/rhosymm.f -c -o $@

$(OBJ)/rinit.o        : $(SRA)/rinit.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/rinit.f -c -o $@

$(OBJ)/rites.o        : $(SRA)/rites.f   $(INCP)             ; \
                         $(FC) $(FFLAGS) $(SRA)/rites.f -c -o $@

$(OBJ)/simp3.o        : $(SRA)/simp3.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/simp3.f -c -o $@

$(OBJ)/simpk.o        : $(SRA)/simpk.f   $(INCP)             ; \
                         $(FC) $(FFLAGS) $(SRA)/simpk.f -c -o $@

$(OBJ)/sinwk.o        : $(SRA)/sinwk.f   $(INCP)             ; \
                         $(FC) $(FFLAGS) $(SRA)/sinwk.f -c -o $@

$(OBJ)/soutk.o        : $(SRA)/soutk.f   $(INCP)             ; \
                         $(FC) $(FFLAGS) $(SRA)/soutk.f -c -o $@

$(OBJ)/ssum.o         : $(SRA)/ssum.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/ssum.f -c -o $@

$(OBJ)/test.o         : $(SRA)/test.f                       ; \
                         $(FC) $(FFLAGS) $(SRA)/test.f -c -o $@

$(OBJ)/vintras.o      : $(SRA)/vintras.f $(INCP)            ; \
                         $(FC) $(FFLAGS) $(SRA)/vintras.f -c -o $@

$(OBJ)/ymy.o          : $(SRA)/ymy.f                          ; \
                         $(FC) $(FFLAGS) $(SRA)/ymy.f -c -o $@

############################################################

##################### sources in COMMON directory ##########

$(OBJ)/main2.o        : $(COM)/main2.f   $(INCP)  ; \
                         $(FC) $(FFLAGS) $(COM)/main2.f -c -o $@

$(OBJ)/epathtb.o      : $(COM)/epathtb.f               ; \
                         $(FC) $(FFLAGS) $(COM)/epathtb.f -c -o $@

$(OBJ)/vmadelblk.o    : $(COM)/vmadelblk.f $(INCP)          ; \
                         $(FC) $(FFLAGS) $(COM)/vmadelblk.f -c -o $@

$(OBJ)/vinterface.o   : $(COM)/vinterface.f $(INCP)         ; \
                         $(FC) $(FFLAGS) $(COM)/vinterface.f -c -o $@

$(OBJ)/etotb1.o       : $(COM)/etotb1.f  $(INCP)              ; \
                         $(FC) $(FFLAGS) $(COM)/etotb1.f -c -o $@

$(OBJ)/rhototb.o      : $(COM)/rhototb.f $(INCP)              ; \
                         $(FC) $(FFLAGS) $(COM)/rhototb.f -c -o $@

############################################################

#################### sources in COM directory stemming ########
#################### from Munich SPR-KKR program       ########

$(OBJ)/calcrotmat.o  : $(COM)/calcrotmat.f               ; \
                     $(FC) $(FFLAGS) $(COM)/calcrotmat.f -c -o $@

$(OBJ)/errortrap.o   : $(COM)/errortrap.f                ; \
                     $(FC) $(FFLAGS) $(COM)/errortrap.f -c -o $@

############################################################

##################### sources in VXC directory #############

$(OBJ)/corlsd.o       : $(VXC)/corlsd.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/corlsd.f -c -o $@

$(OBJ)/cpw91.o        : $(VXC)/cpw91.f                       ; \
                         $(FC) $(FFLAGS) $(VXC)/cpw91.f -c -o $@

$(OBJ)/cylm02.o       : $(VXC)/cylm02.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/cylm02.f -c -o $@

$(OBJ)/exch91.o       : $(VXC)/exch91.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/exch91.f -c -o $@

$(OBJ)/gcor91.o       : $(VXC)/gcor91.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/gcor91.f -c -o $@

$(OBJ)/gradr.o     : $(VXC)/gradr.f                       ; \
                         $(FC) $(FFLAGS) $(VXC)/gradr.f -c -o $@

$(OBJ)/gradrl.o       : $(VXC)/gradrl.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/gradrl.f -c -o $@

$(OBJ)/gxcpt.o        : $(VXC)/gxcpt.f                       ; \
                         $(FC) $(FFLAGS) $(VXC)/gxcpt.f -c -o $@

$(OBJ)/mkxcpe.o       : $(VXC)/mkxcpe.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/mkxcpe.f -c -o $@

$(OBJ)/spher.o        : $(VXC)/spher.f                       ; \
                         $(FC) $(FFLAGS) $(VXC)/spher.f -c -o $@

$(OBJ)/sphere_gga.o   : $(VXC)/sphere_gga.f                       ; \
                         $(FC) $(FFLAGS) $(VXC)/sphere_gga.f -c -o $@

$(OBJ)/sphere_nogga.o : $(VXC)/sphere_nogga.f                     ; \
                         $(FC) $(FFLAGS) $(VXC)/sphere_nogga.f -c -o $@

$(OBJ)/trarea.o       : $(VXC)/trarea.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/trarea.f -c -o $@

$(OBJ)/vosko.o        : $(VXC)/vosko.f                       ; \
                         $(FC) $(FFLAGS) $(VXC)/vosko.f -c -o $@

$(OBJ)/vxcdrv.o       : $(VXC)/vxcdrv.f  $(INCP)             ; \
                         $(FC) $(FFLAGS) $(VXC)/vxcdrv.f -c -o $@

$(OBJ)/vxcgga.o       : $(VXC)/vxcgga.f  $(INCP)             ; \
                         $(FC) $(FFLAGS) $(VXC)/vxcgga.f -c -o $@

$(OBJ)/vxclm.o        : $(VXC)/vxclm.f   $(INCP)             ; \
                         $(FC) $(FFLAGS) $(VXC)/vxclm.f -c -o $@

$(OBJ)/vxcspo.o       : $(VXC)/vxcspo.f                      ; \
                         $(FC) $(FFLAGS) $(VXC)/vxcspo.f -c -o $@

$(OBJ)/lebedev.o  : $(VXC)/lebedev.f                         ; \
                        $(FC) $(FFLAGS) $(VXC)/lebedev.f -c -o $@

############################################################

##################### sources in DRV directory ##########

$(OBJ)/relpotcvt.o    : $(DRV)/relpotcvt.f            ; \
                     $(FC) $(FFLAGS) $(DRV)/relpotcvt.f -c -o $@

############################################################

##################### sources in REL directory ##########

$(OBJ)/mdirnewang.o   : $(REL)/mdirnewang.f                   ; \
	             $(FC) $(FFLAGS) $(REL)/mdirnewang.f -c -o $@

$(OBJ)/scfiterang.o   : $(REL)/scfiterang.f                  ; \
	             $(FC) $(FFLAGS) $(REL)/scfiterang.f -c -o $@

############################################################
$(OBJ)/writekkrflex.o   : $(VIR)/writekkrflex.f                  ; \
	             $(FC) $(FFLAGS) $(VIR)/writekkrflex.f -c -o $@
